(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{170:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("p",[t._v("A hook is a function do anything the doc (the doc object) before the store mutation occurs. You can also modify the docs, or add fields based on conditional checks etc. You can even prevent a doc to be added to your vuex module.")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),a("p",[t._v("You also have some extra parameters to work with:")]),t._v(" "),t._m(9),t._v(" "),t._m(10),a("p",[t._v("Please make sure to check the overview of execution timings of hooks, in the next chapter:")]),t._v(" "),t._m(11),t._v(" "),a("p",[t._v("Notice that the "),a("code",[t._v("created_at")]),t._v(" and "),a("code",[t._v("updated_at")]),t._v(" fields mentioned below is used by default, but can be disabled. To disable just add them to your "),a("router-link",{attrs:{to:"./extra-features.html#fillables-and-guard"}},[t._v("guard config")]),t._v(".")],1),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),a("p",[t._v("I have done my best to limit the hooks to only be executed on the proper events. The server hooks are executed during Firestore's "),a("a",{attrs:{href:"https://firebase.google.com/docs/firestore/query-data/listen",target:"_blank",rel:"noopener noreferrer"}},[t._v("onSnapshot events"),a("OutboundLink")],1),t._v(".")]),t._v(" "),t._m(17)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"hooks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks","aria-hidden":"true"}},[this._v("#")]),this._v(" Hooks")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"hooks-on-local-changes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-on-local-changes","aria-hidden":"true"}},[this._v("#")]),this._v(" Hooks on local changes")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Hooks must be defined inside your vuex module under "),s("code",[this._v("sync")]),this._v(". Below are the examples of all possible hooks that will trigger on 'local' changes. Please also check the overview of "),s("a",{attrs:{href:"#execution-timings-of-hooks"}},[this._v("execution timings of hooks")]),this._v(" to understand the difference between 'local' and 'server' changes.")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// your other vuex-easy-fire config...")]),t._v("\n  sync"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    insertHook"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updateStore"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" store"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("updateStore")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    patchHook"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updateStore"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" store"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("updateStore")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    deleteHook"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updateStore"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" store"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("updateStore")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// Batches have separate hooks!")]),t._v("\n    insertBatchHook"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updateStore"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" docs"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" store"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("updateStore")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    patchBatchHook"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updateStore"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ids"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" store"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("updateStore")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ids"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    deleteBatchHook"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updateStore"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ids"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" store"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("updateStore")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ids"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("The "),a("code",[t._v("doc")]),t._v(" passed in the "),a("code",[t._v("insert")]),t._v(" and "),a("code",[t._v("patch")]),t._v(" hooks will also have an "),a("code",[t._v("id")]),t._v(" field which is either the new id or the id of the doc to be patched.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("You must call `updateStore(doc)` to make the store mutation.")]),this._v(" "),s("p",[this._v("But you may choose not to call this to abort the mutation. If you do not call "),s("code",[this._v("updateStore(doc)")]),this._v(" nothing will happen.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"hooks-after-server-changes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-after-server-changes","aria-hidden":"true"}},[this._v("#")]),this._v(" Hooks after server changes")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("Hooks after server changes")]),this._v(" work just like "),s("em",[this._v("hooks on local changes")]),this._v(" but for changes that have occured on the server. Just as with the hooks for local changes, you can use these hooks to make changes to incoming documents or prevent them from being added to your vuex module.")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("These hooks will fire not only on modifications and inserts "),a("strong",[t._v("but also when dispatching "),a("code",[t._v("openDBChannel")]),t._v(" or "),a("code",[t._v("fetchAndAdd")])]),t._v(". Be sure to check the "),a("strong",[t._v("execution timings of hooks")]),t._v(" below to know when which are executed.")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("em",[t._v("id:")]),t._v(" the doc id returned in "),a("code",[t._v("change.doc.id")]),t._v(" (see firestore documentation for more info)")]),t._v(" "),a("li",[a("em",[t._v("doc:")]),t._v(" the doc returned in "),a("code",[t._v("change.doc.data()")]),t._v(" (see firestore documentation for more info)")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// your other vuex-easy-fire config...")]),t._v("\n  serverChange"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    addedHook"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updateStore"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" store"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("updateStore")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    modifiedHook"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updateStore"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" store"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("updateStore")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    removedHook"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updateStore"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" store"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("updateStore")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"execution-timings-of-hooks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#execution-timings-of-hooks","aria-hidden":"true"}},[this._v("#")]),this._v(" Execution timings of hooks")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("Hooks on 'collection' mode")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("table",[a("tr",[a("th",[t._v("change type")]),t._v(" "),a("th",{attrs:{colspan:"2"}},[t._v("local")]),t._v(" "),a("th",[t._v("server")])]),t._v(" "),a("tr",[a("td",[t._v("insertion")]),t._v(" "),a("td",[a("b",[t._v("without "),a("code",[t._v("created_at")])]),t._v(" "),a("ol",[a("li",[a("code",[t._v("sync.insertHook")])])])]),t._v(" "),a("td",[a("b",[t._v("with "),a("code",[t._v("created_at")])]),t._v(" "),a("ol",[a("li",[a("code",[t._v("sync.insertHook")])]),t._v(" "),a("li",[a("code",[t._v("serverChange.modifiedHook")])])])]),t._v(" "),a("td",[a("code",[t._v("serverChange.addedHook")])])]),t._v(" "),a("tr",[a("td",[t._v("modification")]),t._v(" "),a("td",[a("b",[t._v("without "),a("code",[t._v("updated_at")])]),t._v(" "),a("ol",[a("li",[a("code",[t._v("sync.patchHook")])])])]),t._v(" "),a("td",[a("b",[t._v("with "),a("code",[t._v("updated_at")])]),t._v(" "),a("ol",[a("li",[a("code",[t._v("sync.patchHook")])]),t._v(" "),a("li",[a("code",[t._v("serverChange.modifiedHook")])])])]),t._v(" "),a("td",[a("code",[t._v("serverChange.modifiedHook")])])]),t._v(" "),a("tr",[a("td",[t._v("deletion")]),t._v(" "),a("td",{attrs:{colspan:"2"}},[a("ol",[a("li",[a("code",[t._v("sync.deleteHook")])]),t._v(" "),a("li",[a("code",[t._v("serverChange.removedHook")])])])]),t._v(" "),a("td",[a("code",[t._v("serverChange.removedHook")])])]),t._v(" "),a("tr",[a("td",[t._v("on "),a("code",[t._v("openDBChannel")]),a("br"),t._v("and"),a("br"),a("code",[t._v("fetchAndAdd")])]),t._v(" "),a("td",{attrs:{colspan:"3"}},[a("code",[t._v("serverChange.addedHook")]),t._v(" is executed once for each doc")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("Hooks on 'doc' mode")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("table",[a("tr",[a("th",[t._v("change type")]),t._v(" "),a("th",{attrs:{colspan:"2"}},[t._v("local")]),t._v(" "),a("th",[t._v("server")])]),t._v(" "),a("tr",[a("td",[t._v("modification")]),t._v(" "),a("td",[a("b",[t._v("without "),a("code",[t._v("updated_at")])]),t._v(" "),a("ol",[a("li",[a("code",[t._v("sync.patchHook")])])])]),t._v(" "),a("td",[a("b",[t._v("with "),a("code",[t._v("updated_at")])]),t._v(" "),a("ol",[a("li",[a("code",[t._v("sync.patchHook")])]),t._v(" "),a("li",[a("code",[t._v("serverChange.modifiedHook")])])])]),t._v(" "),a("td",[a("code",[t._v("serverChange.modifiedHook")])])]),t._v(" "),a("tr",[a("td",[t._v("on "),a("code",[t._v("openDBChannel")]),a("br"),t._v("and"),a("br"),a("code",[t._v("fetchAndAdd")])]),t._v(" "),a("td",{attrs:{colspan:"3"}},[a("code",[t._v("serverChange.modifiedHook")]),t._v(" is executed once")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"note-about-the-serverchange-hooks-executing-on-local-changes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#note-about-the-serverchange-hooks-executing-on-local-changes","aria-hidden":"true"}},[this._v("#")]),this._v(" Note about the serverChange hooks executing on local changes")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("The reason for "),a("code",[t._v("updated_at")]),t._v(" to trigger "),a("code",[t._v("serverChange.modifiedHook")]),t._v(" even on just a local change, is because "),a("code",[t._v("updated_at")]),t._v(" uses Firestore's "),a("code",[t._v("firebase.firestore.FieldValue.serverTimestamp()")]),t._v(' which is replaced by a timestamp on the server and therefor there is a "server change".')])}],!1,null,null,null);e.options.__file="hooks.md";s.default=e.exports}}]);